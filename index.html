<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TNA CHO Loading Plan</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        .password-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .app-hidden { display: none !important; }
        .password-form {
            background: white; padding: 2rem; border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 400px; width: 90%; text-align: center;
        }
        .password-input {
            width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb;
            border-radius: 0.5rem; font-size: 1rem; margin: 1rem 0;
        }
        .password-button {
            width: 100%; padding: 0.75rem; background: #3b82f6; color: white;
            border: none; border-radius: 0.5rem; font-size: 1rem; cursor: pointer;
        }
        .error-message { color: #ef4444; margin-top: 0.5rem; display: none; }
    </style>
</head>
<body>
    <div id="password-overlay" class="password-overlay">
        <div class="password-form">
            <h1 style="color: #1f2937; font-size: 2rem; margin-bottom: 0.5rem;">üèÉ‚Äç‚ôÇÔ∏è TNA CHO Loading Plan</h1>
            <p style="color: #6b7280; margin-bottom: 1.5rem;">Enter password to access your nutrition planning tool</p>
            <input type="password" id="password-input" placeholder="Enter password" class="password-input" />
            <button onclick="checkPassword()" class="password-button">Access App</button>
            <div id="error-message" class="error-message">‚ùå Incorrect password. Please try again.</div>
        </div>
    </div>

    <div id="main-app" class="app-hidden">
        <div id="react-app"></div>
    </div>

    <script>
        const CORRECT_PASSWORD = "CHOLoading2024";
        
        function checkPassword() {
            const passwordInput = document.getElementById('password-input');
            const errorMessage = document.getElementById('error-message');
            const enteredPassword = passwordInput.value;
            
            if (enteredPassword === CORRECT_PASSWORD) {
                document.getElementById('password-overlay').style.display = 'none';
                document.getElementById('main-app').classList.remove('app-hidden');
                loadReactApp();
            } else {
                errorMessage.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        }
        
        document.getElementById('password-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkPassword();
        });
        
        window.addEventListener('load', function() {
            document.getElementById('password-input').focus();
        });
        
        function loadReactApp() {
            ReactDOM.render(React.createElement(CHOLoadingApp), document.getElementById('react-app'));
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Plus, Trash2, Calculator, Target, Activity } = lucideReact;

        const CHOLoadingApp = () => {
            const [activeDay, setActiveDay] = useState(1);
            const [bodyMass, setBodyMass] = useState({ total: 0, lean: 0 });
            const [unit, setUnit] = useState('Kg');
            const [meals, setMeals] = useState({
                1: { breakfast: [], snack1: [], lunch: [], snack2: [], dinner: [], snack3: [] },
                2: { breakfast: [], snack1: [], lunch: [], snack2: [], dinner: [], snack3: [] }
            });

            // Sample foods database (working version with proper formatting)
            const baseFoodsDatabase = [
                { name: "1 x Thick slice raisin toast", carbs: 38, energyKJ: 865, energyKcal: 207, protein: 6, fat: 1, fibre: 2 },
                { name: "1 x regular slice white bread", carbs: 15, energyKJ: 330, energyKcal: 79, protein: 3, fat: 0.6, fibre: 1 },
                { name: "1 x square crumpet", carbs: 26, energyKJ: 528, energyKcal: 125, protein: 3, fat: 0.5, fibre: 1.5 },
                { name: "English muffin (white)", carbs: 28, energyKJ: 683, energyKcal: 163, protein: 7.4, fat: 1.5, fibre: 2.3 },
                { name: "Bagel (white) 120g", carbs: 61, energyKJ: 1315, energyKcal: 315, protein: 11.4, fat: 1.7, fibre: 3.7 },
                { name: "1 Banana (medium)", carbs: 19, energyKJ: 385, energyKcal: 90, protein: 1.4, fat: 0, fibre: 2.2 },
                { name: "1 cup white rice (cooked)", carbs: 68, energyKJ: 1290, energyKcal: 305, protein: 5.9, fat: 0.4, fibre: 1.5 },
                { name: "1 cup cooked pasta", carbs: 42, energyKJ: 930, energyKcal: 222, protein: 8, fat: 2, fibre: 2.2 },
                { name: "250ml skim milk", carbs: 12, energyKJ: 350, energyKcal: 84, protein: 8.5, fat: 0.3, fibre: 0 },
                { name: "1 tbsp honey", carbs: 23, energyKJ: 375, energyKcal: 90, protein: 0, fat: 0, fibre: 0 },
                { name: "1 x medium banana muffin (165g)", carbs: 84, energyKJ: 2300, energyKcal: 550, protein: 10, fat: 20, fibre: 2 },
                { name: "Recipe Database - CHO Loading Smoothie (dairy)", carbs: 115, energyKJ: 3000, energyKcal: 710, protein: 26, fat: 15, fibre: 8 },
                { name: "600ml Gatorade/Powerade bottle", carbs: 36, energyKJ: 620, energyKcal: 148, protein: 0, fat: 0, fibre: 0 },
                { name: "2 cups white rice (cooked)", carbs: 137, energyKJ: 2580, energyKcal: 617, protein: 11.8, fat: 0.7, fibre: 3 },
                { name: "1 Large Turkish Bread Roll (160g)", carbs: 73, energyKJ: 1655, energyKcal: 395, protein: 12.5, fat: 4.5, fibre: 5.7 }
            ];

            const [customFoods, setCustomFoods] = useState([]);
            const foodsDatabase = [...baseFoodsDatabase, ...customFoods];

            const addCustomFood = (newFood) => {
                setCustomFoods(prev => [...prev, { ...newFood, isCustom: true }]);
            };

            const calculateTargets = () => {
                const totalMass = unit === 'Kg' ? bodyMass.total : bodyMass.total / 2.2046;
                const leanMass = unit === 'Kg' ? bodyMass.lean : bodyMass.lean / 2.2046;
                return {
                    carbs: { min: 7 * leanMass, max: 12 * leanMass },
                    energy: { min: 225 * totalMass, max: 250 * totalMass },
                    protein: { min: 0.8 * totalMass, max: 2 * totalMass },
                    fibre: { min: 0, max: 30 },
                    fat: { min: 0, max: 80 }
                };
            };

            const calculateTotals = (dayMeals) => {
                let totals = { carbs: 0, energyKJ: 0, energyKcal: 0, protein: 0, fat: 0, fibre: 0 };
                Object.values(dayMeals).forEach(mealItems => {
                    mealItems.forEach(item => {
                        const food = foodsDatabase.find(f => f.name === item.food);
                        if (food) {
                            totals.carbs += (food.carbs * item.quantity);
                            totals.energyKJ += (food.energyKJ * item.quantity);
                            totals.energyKcal += (food.energyKcal * item.quantity);
                            totals.protein += (food.protein * item.quantity);
                            totals.fat += (food.fat * item.quantity);
                            totals.fibre += (food.fibre * item.quantity);
                        }
                    });
                });
                return totals;
            };

            const addFoodItem = (meal, food, quantity) => {
                setMeals(prev => ({
                    ...prev,
                    [activeDay]: {
                        ...prev[activeDay],
                        [meal]: [...prev[activeDay][meal], { food: food.name, quantity: parseFloat(quantity) || 1 }]
                    }
                }));
            };

            const removeFoodItem = (meal, index) => {
                setMeals(prev => ({
                    ...prev,
                    [activeDay]: {
                        ...prev[activeDay],
                        [meal]: prev[activeDay][meal].filter((_, i) => i !== index)
                    }
                }));
            };

            const targets = calculateTargets();
            const totals = calculateTotals(meals[activeDay]);
            const totalMass = unit === 'Kg' ? bodyMass.total : bodyMass.total / 2.2046;
            const leanMass = unit === 'Kg' ? bodyMass.lean : bodyMass.lean / 2.2046;

            const ratios = {
                carbsPerKgLean: leanMass > 0 ? totals.carbs / leanMass : 0,
                energyPerKgTotal: totalMass > 0 ? totals.energyKJ / totalMass : 0,
                proteinPerKgTotal: totalMass > 0 ? totals.protein / totalMass : 0
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-gray-800 mb-2">üèÉ‚Äç‚ôÇÔ∏è TNA CHO Loading Plan</h1>
                                    <h2 className="text-xl text-gray-600">Carbohydrate Loading Plan</h2>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setActiveDay(1)}
                                        className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                            activeDay === 1 ? 'bg-blue-600 text-white shadow-lg' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`}
                                    >
                                        Day 1
                                    </button>
                                    <button
                                        onClick={() => setActiveDay(2)}
                                        className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                            activeDay === 2 ? 'bg-blue-600 text-white shadow-lg' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`}
                                    >
                                        Day 2
                                    </button>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Body Mass Unit</label>
                                    <select value={unit} onChange={(e) => setUnit(e.target.value)} className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                                        <option value="Kg">Kg (metric)</option>
                                        <option value="Lbs">Lbs (imperial)</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Total Body Mass ({unit})</label>
                                    <input type="number" value={bodyMass.total} onChange={(e) => setBodyMass(prev => ({ ...prev, total: parseFloat(e.target.value) || 0 }))} className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter total mass" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">Lean Body Mass ({unit})</label>
                                    <input type="number" value={bodyMass.lean} onChange={(e) => setBodyMass(prev => ({ ...prev, lean: parseFloat(e.target.value) || 0 }))} className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500" placeholder="Enter lean mass" />
                                </div>
                                <div className="text-sm text-gray-600">
                                    <div>Other unit: {unit === 'Kg' ? 'Lbs' : 'Kg'}</div>
                                    <div>Total: {unit === 'Kg' ? (bodyMass.total * 2.2046).toFixed(1) : (bodyMass.total / 2.2046).toFixed(1)}</div>
                                    <div>Lean: {unit === 'Kg' ? (bodyMass.lean * 2.2046).toFixed(1) : (bodyMass.lean / 2.2046).toFixed(1)}</div>
                                </div>
                            </div>

                            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                                <div className={`p-4 rounded-lg border-2 ${totals.carbs >= targets.carbs.min && totals.carbs <= targets.carbs.max ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}`}>
                                    <h4 className="font-semibold text-gray-800 text-sm mb-1">Carbohydrates</h4>
                                    <div className="text-lg font-bold text-gray-900">{totals.carbs.toFixed(1)} g</div>
                                    <div className="text-xs text-gray-600">Target: {targets.carbs.min.toFixed(0)}-{targets.carbs.max.toFixed(0)} g</div>
                                </div>
                                <div className={`p-4 rounded-lg border-2 ${totals.energyKJ >= targets.energy.min && totals.energyKJ <= targets.energy.max ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}`}>
                                    <h4 className="font-semibold text-gray-800 text-sm mb-1">Energy</h4>
                                    <div className="text-lg font-bold text-gray-900">{totals.energyKJ.toFixed(0)} kJ</div>
                                    <div className="text-xs text-gray-600">Target: {targets.energy.min.toFixed(0)}-{targets.energy.max.toFixed(0)} kJ</div>
                                </div>
                                <div className={`p-4 rounded-lg border-2 ${totals.protein >= targets.protein.min && totals.protein <= targets.protein.max ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}`}>
                                    <h4 className="font-semibold text-gray-800 text-sm mb-1">Protein</h4>
                                    <div className="text-lg font-bold text-gray-900">{totals.protein.toFixed(1)} g</div>
                                    <div className="text-xs text-gray-600">Target: {targets.protein.min.toFixed(1)}-{targets.protein.max.toFixed(1)} g</div>
                                </div>
                                <div className={`p-4 rounded-lg border-2 ${totals.fibre <= 30 ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}`}>
                                    <h4 className="font-semibold text-gray-800 text-sm mb-1">Fibre</h4>
                                    <div className="text-lg font-bold text-gray-900">{totals.fibre.toFixed(1)} g</div>
                                    <div className="text-xs text-gray-600">Target: &lt;30 g</div>
                                </div>
                                <div className={`p-4 rounded-lg border-2 ${totals.fat <= 80 ? 'border-green-200 bg-green-50' : 'border-orange-200 bg-orange-50'}`}>
                                    <h4 className="font-semibold text-gray-800 text-sm mb-1">Fat</h4>
                                    <div className="text-lg font-bold text-gray-900">{totals.fat.toFixed(1)} g</div>
                                    <div className="text-xs text-gray-600">Target: &lt;80 g</div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div className="space-y-6">
                                {Object.keys(meals[activeDay]).map(mealType => (
                                    <MealSection
                                        key={mealType}
                                        mealType={mealType}
                                        items={meals[activeDay][mealType]}
                                        foodsDatabase={foodsDatabase}
                                        onAddFood={addFoodItem}
                                        onRemoveFood={removeFoodItem}
                                        onAddCustomFood={addCustomFood}
                                    />
                                ))}
                            </div>

                            <div className="lg:sticky lg:top-4 h-fit">
                                <div className="bg-white rounded-xl shadow-lg p-6">
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">Day {activeDay} Summary</h3>
                                    <div className="space-y-3">
                                        <div className="flex justify-between">
                                            <span>Carbohydrates:</span>
                                            <span className="font-bold">{totals.carbs.toFixed(1)} g</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Energy:</span>
                                            <span className="font-bold">{totals.energyKJ.toFixed(0)} kJ</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Energy:</span>
                                            <span className="font-bold">{totals.energyKcal.toFixed(0)} kcal</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Protein:</span>
                                            <span className="font-bold">{totals.protein.toFixed(1)} g</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Fat:</span>
                                            <span className="font-bold">{totals.fat.toFixed(1)} g</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Fibre:</span>
                                            <span className="font-bold">{totals.fibre.toFixed(1)} g</span>
                                        </div>
                                    </div>
                                    <hr className="my-4" />
                                    <div className="space-y-2 text-sm">
                                        <div className="flex justify-between">
                                            <span>CHO per kg lean mass:</span>
                                            <span className={ratios.carbsPerKgLean >= 7 && ratios.carbsPerKgLean <= 12 ? 'text-green-600 font-bold' : 'text-orange-600 font-bold'}>
                                                {ratios.carbsPerKgLean.toFixed(1)} g/kg
                                            </span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span>Energy per kg total mass:</span>
                                            <span className={ratios.energyPerKgTotal >= 225 && ratios.energyPerKgTotal <= 250 ? 'text-green-600 font-bold' : 'text-orange-600 font-bold'}>
                                                {ratios.energyPerKgTotal.toFixed(0)} kJ/kg
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const MealSection = ({ mealType, items, foodsDatabase, onAddFood, onRemoveFood, onAddCustomFood }) => {
            const [selectedFood, setSelectedFood] = useState('');
            const [quantity, setQuantity] = useState(1);
            const [searchTerm, setSearchTerm] = useState('');
            const [showAllFoods, setShowAllFoods] = useState(false);

            const mealNames = {
                breakfast: 'Breakfast',
                snack1: 'Snack 1',
                lunch: 'Lunch',
                snack2: 'Snack 2',
                dinner: 'Dinner',
                snack3: 'Snack 3 (optional)'
            };

            const filteredFoods = searchTerm 
                ? foodsDatabase.filter(food => food.name.toLowerCase().includes(searchTerm.toLowerCase()))
                : foodsDatabase;

            const handleAddFood = () => {
                const food = foodsDatabase.find(f => f.name === selectedFood);
                if (food && quantity > 0) {
                    onAddFood(mealType, food, quantity);
                    setSelectedFood('');
                    setQuantity(1);
                    setSearchTerm('');
                    setShowAllFoods(false);
                }
            };

            return (
                <div className="bg-white rounded-xl shadow-lg p-6">
                    <h3 className="text-lg font-bold text-gray-800 mb-4">{mealNames[mealType]}</h3>
                    
                    <div className="space-y-4 mb-4 p-4 bg-gray-50 rounded-lg">
                        <div className="text-xs text-gray-500 bg-yellow-50 p-2 rounded">
                            Debug: Total foods available: {foodsDatabase.length}
                        </div>
                        
                        <div className="flex gap-2">
                            <button
                                onClick={() => {
                                    setShowAllFoods(false);
                                    setSearchTerm('');
                                }}
                                className={`px-3 py-2 rounded-md text-sm font-medium ${
                                    !showAllFoods ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                Search Foods
                            </button>
                            <button
                                onClick={() => {
                                    setShowAllFoods(true);
                                    setSearchTerm('');
                                }}
                                className={`px-3 py-2 rounded-md text-sm font-medium ${
                                    showAllFoods ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                Browse All Foods
                            </button>
                        </div>

                        {!showAllFoods && (
                            <input
                                type="text"
                                placeholder="Search foods..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                            />
                        )}
                        
                        {(searchTerm || showAllFoods) && (
                            <select
                                value={selectedFood}
                                onChange={(e) => setSelectedFood(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                size="8"
                            >
                                <option value="">Select from {filteredFoods.length} foods...</option>
                                {filteredFoods.map((food, index) => (
                                    <option key={index} value={food.name}>
                                        {food.name} - CHO: {food.carbs}g, {food.energyKcal}kcal
                                    </option>
                                ))}
                            </select>
                        )}
                        
                        <div className="flex gap-2">
                            <input
                                type="number"
                                step="0.1"
                                min="0"
                                value={quantity}
                                onChange={(e) => setQuantity(parseFloat(e.target.value) || 1)}
                                className="flex-1 p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                placeholder="Quantity"
                            />
                            <button
                                onClick={handleAddFood}
                                disabled={!selectedFood}
                                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-300"
                            >
                                Add
                            </button>
                        </div>
                    </div>

                    <div className="space-y-2">
                        {items.map((item, index) => {
                            const food = foodsDatabase.find(f => f.name === item.food);
                            if (!food) return null;

                            return (
                                <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div className="flex-1">
                                        <div className="font-medium text-gray-800">{food.name}</div>
                                        <div className="text-sm text-gray-600">
                                            Qty: {item.quantity} | CHO: {(food.carbs * item.quantity).toFixed(1)}g | Energy: {(food.energyKcal * item.quantity).toFixed(0)}kcal
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => onRemoveFood(mealType, index)}
                                        className="ml-2 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"
                                    >
                                        Remove
                                    </button>
                                </div>
                            );
                        })}
                        
                        {items.length === 0 && (
                            <div className="text-center text-gray-500 py-4">
                                No foods added yet. Use the form above to add foods.
                            </div>
                        )}
                    </div>
                </div>
            );
        };
    </script>
</body>
</html>
